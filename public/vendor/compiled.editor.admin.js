if(window.jQuery===undefined)jQuery=$={};!function($,window,document){"use strict";var o=tinymce.util.Tools.resolve("tinymce.PluginManager"),e=tinymce.util.Tools.resolve("tinymce.util.Tools"),t=function(t){t=e.trim(t);var o=function(o,e){t=t.replace(o,e)};return(o(/\n/gi,"<br />"),o(/\[b\]/gi,"<strong>"),o(/\[\/b\]/gi,"</strong>"),o(/\[i\]/gi,"<em>"),o(/\[\/i\]/gi,"</em>"),o(/\[u\]/gi,"<u>"),o(/\[\/u\]/gi,"</u>"),o(/\[s\]/gi,"<s>"),o(/\[\/s\]/gi,"</s>"),o(/\[url=([^\]]+)\](.*?)\[\/url\]/gi,'<a href="$1">$2</a>'),o(/\[url\](.*?)\[\/url\]/gi,'<a href="$1">$1</a>'),o(/\[img=(.*?)\](.*?)\[\/img\]/gi,'<img src="$2" alt="$1" />'),o(/\[color=(.*?)\](.*?)\[\/color\]/gi,'<font color="$1">$2</font>'),o(/\[size=(.*?)\](.*?)\[\/size\]/gi,'<span style="font-size: $1">$2</span>'),o(/\[heading=(.*?)\](.*?)\[\/heading\]/gi,'<h$1>$2</h$1>'),o(/\[background=(.*?)\](.*?)\[\/background\]/gi,'<span style="background-color: $1;">$2</span>'),o(/\[align=(.*?)\](.*?)\[\/align\]/gi,'<p style="text-align: $1;">$2</p>'),o(/\[list=disc\](.*?)\[\/list\](<br \/>)?/gi,'<ul>$1</ul>'),o(/\[list=decimal\](.*?)\[\/list\](<br \/>)?/gi,'<ol>$1</ol>'),o(/\[li\](.*?)\[\/li](<br \/>)?/gi,'<li>$1</li>'),o(/\[table=(.*?);border=(.*?)\](.*?)\[\/table\](<br \/>)?/gi,'<table style="$1" border="$2">$3</table>'),o(/\[tr\](.*?)\[\/tr\](<br \/>)?/gi,'<tr>$1</tr>'),o(/\[td=(.*?)\](.*?)\[\/td\](<br \/>)?/gi,'<td style="$1">$2</td>'),o(/\[code=(.*?)\](.*?)\[\/code\]/gi,'<pre class="language-$1"><code class="language-$1">$2</code></pre>'),t)};!(function i(){o.add("bbcodeCustom",function(o){o.on("BeforeSetContent",function(o){o.content=t(o.content)}),o.on("PostProcess",function(o){o.set&&(o.content=t(o.content)),o.get&&(o.content=(function(t){t=e.trim(t);var o=function(o,e){t=t.replace(o,e)};return(o(/<a.*?href=\"(.*?)\".*?>(.*?)<\/a>/gi,"[url=$1]$2[/url]"),o(/<font.*?color=\"(.*?)\".*?class=\"codeStyle\".*?>(.*?)<\/font>/gi,"[code][color=$1]$2[/color][/code]"),o(/<font.*?color=\"(.*?)\".*?class=\"quoteStyle\".*?>(.*?)<\/font>/gi,"[quote][color=$1]$2[/color][/quote]"),o(/<font.*?class=\"codeStyle\".*?color=\"(.*?)\".*?>(.*?)<\/font>/gi,"[code][color=$1]$2[/color][/code]"),o(/<font.*?class=\"quoteStyle\".*?color=\"(.*?)\".*?>(.*?)<\/font>/gi,"[quote][color=$1]$2[/color][/quote]"),o(/<span style=\"color: ?(.*?);\">(.*?)<\/span>/gi,"[color=$1]$2[/color]"),o(/<font.*?color=\"(.*?)\".*?>(.*?)<\/font>/gi,"[color=$1]$2[/color]"),o(/<span style=\"font-size:(.*?);\">(.*?)<\/span>/gi,"[size=$1]$2[/size]"),o(/<font>(.*?)<\/font>/gi,"$1"),o(/<img class="js-Twemoji_MentionEditor"(?:.*?)alt="(.*?)" \/>/gi,'$1'),o(/<img.*?src=\"(.*?)\" alt=\"(.*?)\".*?\/>/gi,"[img=$2]$1[/img]"),o(/<span class=\"codeStyle\">(.*?)<\/span>/gi,"[code]$1[/code]"),o(/<span class=\"quoteStyle\">(.*?)<\/span>/gi,"[quote]$1[/quote]"),o(/<strong class=\"codeStyle\">(.*?)<\/strong>/gi,"[code][b]$1[/b][/code]"),o(/<strong class=\"quoteStyle\">(.*?)<\/strong>/gi,"[quote][b]$1[/b][/quote]"),o(/<em class=\"codeStyle\">(.*?)<\/em>/gi,"[code][i]$1[/i][/code]"),o(/<em class=\"quoteStyle\">(.*?)<\/em>/gi,"[quote][i]$1[/i][/quote]"),o(/<u class=\"codeStyle\">(.*?)<\/u>/gi,"[code][u]$1[/u][/code]"),o(/<u class=\"quoteStyle\">(.*?)<\/u>/gi,"[quote][u]$1[/u][/quote]"),o(/<\/(strong|b)>/gi,"[/b]"),o(/<(strong|b)>/gi,"[b]"),o(/<(s|b)>/gi,"[s]"),o(/<\/(em|i)>/gi,"[/i]"),o(/<(em|i)>/gi,"[i]"),o(/<\/u>/gi,"[/u]"),o(/<\/s>/gi,"[/s]"),o(/<span style=\"text-decoration: ?underline;\">(.*?)<\/span>/gi,"[u]$1[/u]"),o(/<span style=\"text-decoration: ?line-through;\">(.*?)<\/span>/gi,"[s]$1[/s]"),o(/<u>/gi,"[u]"),o(/<blockquote[^>]*>/gi,"[quote]"),o(/<\/blockquote>/gi,"[/quote]"),o(/<br \/>/gi,"\n"),o(/<br\/>/gi,"\n"),o(/<br>/gi,"\n"),o(/&nbsp;|\u00a0/gi," "),o(/&quot;/gi,'"'),o(/&lt;/gi,"<"),o(/&gt;/gi,">"),o(/&amp;/gi,"&"),o(/<ul>/gi,"[list=disc]"),o(/<\/ul>/gi,"[/list]"),o(/<ol>/gi,"[list=decimal]"),o(/<\/ol>/gi,"[/list]"),o(/<li>(.*?)<\/li>/gi,"[li]$1[/li]"),o(/<p style="text-align: (.*?);">(.*?)<\/p>/gi,"[align=$1]$2[/align]"),o(/<p>/gi,""),o(/<\/p>/gi,""),o(/<span style="font-size: (.*?);">(.*?)<\/span>/gi,"[size=$1]$2[/size]"),o(/<span style="background-color: (.*?);">(.*?)<\/span>/gi,"[background=$1]$2[/background]"),o(/<pre class="language-(.*?)"><code>(.*?)<\/code><\/pre>/gi,"[code=$1]$2[/code]"),o(/<h(1|2|3|4|5|6)>(.*?)<\/h(1|2|3|4|5|6)>/gi,'[heading=$1]$2[/heading]'),o(/<pre>(.*?)<\/pre>/gi,'[pre]$1[/pre]'),o(/<span style="font-family: (.*?);">(.*?)<\/span>/gi,'[font=$1]$2[/font]'),o(/<table style="(.*?);" border="(.*?)">/gi,'[table=$1;border=$2]'),o(/<tbody>/gi,''),o(/<tr( style=".*?")?>/gi,'[tr]'),o(/<td style="(.*?)">(.*?)<\/td>/gi,'[td=$1]$2[/td]'),o(/<\/tbody>/gi,''),o(/<\/tr>/gi,'[/tr]'),o(/<\/table>/gi,'[/table]'),t)})(o.content))})})})()}(window.jQuery,window,document);if(window.jQuery===undefined)jQuery=$={};!function($,window,document){"use strict";$(function(){tinymce.PluginManager.add("userTagging",function(editor,url){editor.ui.registry.addAutocompleter('autocompleter-user-tagging',{ch:'@',minChars:2,columns:1,fetch:function(pattern){return new tinymce.util.Promise(function(resolve){var dataString={pattern:pattern}
app.post("post/user-tagging",dataString).done(function(response){if(response.status==="ok"){var data=response.data;var results=[];for(var i=0;i<data.length;i++){var result=data[i];results.push({value:result.username,text:result.username,icon:'<img class="rounded-circle w-100" src="'+app.config.settings.public_dir+'/uploads/profile_picture/'+result.profile_picture+'" />'})};results.sort(function(a,b){var x=a.text.toLowerCase();var y=b.text.toLowerCase();if(x<y){return-1}
if(x>y){return 1}
return 0});resolve(results)}}).fail(function(xhr,status,err){console.log(status,err)})})},onAction:function(autocompleteApi,rng,value){var render='<span style="color: rgb(53, 152, 219);"><strong>@'+value+';</strong></span>';editor.selection.setRng(rng);editor.insertContent(render);editor.execCommand('Forecolor');autocompleteApi.hide()}});return{getMetadata:function(){return{name:"Mention User tagging for TinyMCE 5",url:"https://www.r10.net/members/90047-scarecrow.html"}}}})})}(window.jQuery,window,document);if(window.jQuery===undefined)jQuery=$={};!function($,window,document){"use strict";$(function(){tinymce.PluginManager.add("spoiler",function(editor,url){editor.ui.registry.addButton('spoiler',{icon:'spoiler',tooltip:'Spoiler',onAction:function(_){editor.insertContent('\n[spoiler=Spoiler!]'+editor.selection.getContent()+'[/spoiler]\n')}})})})}(window.jQuery,window,document);if(window.jQuery===undefined)jQuery=$={};!function($,window,document){"use strict";var global=tinymce.util.Tools.resolve('tinymce.PluginManager');var DEFAULT_ID='tinymce.plugins.emoticons';var getEmoticonDatabase=function(editor){return editor.getParam('emoticons_database','emojis','string')};var getEmoticonDatabaseUrl=function(editor,pluginUrl){var database=getEmoticonDatabase(editor);return editor.getParam('emoticons_database_url',pluginUrl+'/js/'+database+editor.suffix+'.js','string')};var getEmoticonDatabaseId=function(editor){return editor.getParam('emoticons_database_id',DEFAULT_ID,'string')};var getAppendedEmoticons=function(editor){return editor.getParam('emoticons_append',{},'object')};var getEmotionsImageUrl=function(editor){return editor.getParam('emoticons_images_url','https://twemoji.maxcdn.com/v/13.0.1/72x72/','string')};var __assign=function(){__assign=Object.assign||function __assign(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)
if(Object.prototype.hasOwnProperty.call(s,p))
t[p]=s[p]}
return t};return __assign.apply(this,arguments)};var Cell=function(initial){var value=initial;var get=function(){return value};var set=function(v){value=v};return{get:get,set:set}};var hasOwnProperty=Object.prototype.hasOwnProperty;var shallow=function(old,nu){return nu};var baseMerge=function(merger){return function(){var objects=new Array(arguments.length);for(var i=0;i<objects.length;i++){objects[i]=arguments[i]}
if(objects.length===0){throw new Error('Can\'t merge zero objects')}
var ret={};for(var j=0;j<objects.length;j++){var curObject=objects[j];for(var key in curObject){if(hasOwnProperty.call(curObject,key)){ret[key]=merger(ret[key],curObject[key])}}}
return ret}};var merge=baseMerge(shallow);var noop=function(){};var constant=function(value){return function(){return value}};var never=constant(!1);var always=constant(!0);var none=function(){return NONE};var NONE=function(){var eq=function(o){return o.isNone()};var call=function(thunk){return thunk()};var id=function(n){return n};var me={fold:function(n,_s){return n()},is:never,isSome:never,isNone:always,getOr:id,getOrThunk:call,getOrDie:function(msg){throw new Error(msg||'error: getOrDie called on none.')},getOrNull:constant(null),getOrUndefined:constant(undefined),or:id,orThunk:call,map:none,each:noop,bind:none,exists:never,forall:always,filter:none,equals:eq,equals_:eq,toArray:function(){return[]},toString:constant('none()')};return me}();var some=function(a){var constant_a=constant(a);var self=function(){return me};var bind=function(f){return f(a)};var me={fold:function(n,s){return s(a)},is:function(v){return a===v},isSome:always,isNone:never,getOr:constant_a,getOrThunk:constant_a,getOrDie:constant_a,getOrNull:constant_a,getOrUndefined:constant_a,or:self,orThunk:self,map:function(f){return some(f(a))},each:function(f){f(a)},bind:bind,exists:bind,forall:bind,filter:function(f){return f(a)?me:NONE},toArray:function(){return[a]},toString:function(){return'some('+a+')'},equals:function(o){return o.is(a)},equals_:function(o,elementEq){return o.fold(never,function(b){return elementEq(a,b)})}};return me};var from=function(value){return value===null||value===undefined?NONE:some(value)};var Optional={some:some,none:none,from:from};var keys=Object.keys;var hasOwnProperty$1=Object.hasOwnProperty;var each=function(obj,f){var props=keys(obj);for(var k=0,len=props.length;k<len;k++){var i=props[k];var x=obj[i];f(x,i)}};var map=function(obj,f){return tupleMap(obj,function(x,i){return{k:i,v:f(x,i)}})};var tupleMap=function(obj,f){var r={};each(obj,function(x,i){var tuple=f(x,i);r[tuple.k]=tuple.v});return r};var has=function(obj,key){return hasOwnProperty$1.call(obj,key)};var checkRange=function(str,substr,start){return substr===''||str.length>=substr.length&&str.substr(start,start+substr.length)===substr};var contains=function(str,substr){return str.indexOf(substr)!==-1};var startsWith=function(str,prefix){return checkRange(str,prefix,0)};var global$1=tinymce.util.Tools.resolve('tinymce.Resource');var global$2=tinymce.util.Tools.resolve('tinymce.util.Delay');var global$3=tinymce.util.Tools.resolve('tinymce.util.Promise');var ALL_CATEGORY='All';var categoryNameMap={symbols:'Symbols',people:'People',animals_and_nature:'Animals and Nature',food_and_drink:'Food and Drink',activity:'Activity',travel_and_places:'Travel and Places',objects:'Objects',flags:'Flags',user:'User Defined'};var translateCategory=function(categories,name){return has(categories,name)?categories[name]:name};var getUserDefinedEmoticons=function(editor){var userDefinedEmoticons=getAppendedEmoticons(editor);return map(userDefinedEmoticons,function(value){return __assign({keywords:[],category:'user'},value)})};var initDatabase=function(editor,databaseUrl,databaseId){var categories=Cell(Optional.none());var all=Cell(Optional.none());var emojiImagesUrl=getEmotionsImageUrl(editor);var getEmoji=function(lib){if(startsWith(lib.char,'<img')){return lib.char.replace(/src="([^"]+)"/,function(match,url){return'src="'+emojiImagesUrl+url+'"'})}else{var parse=twemoji.parse(lib.char);return parse.replace(/src="([^"]+)"/,function(match,url){return'style="width: 22px"'+match+''})}};var processEmojis=function(emojis){var cats={};var everything=[];each(emojis,function(lib,title){var entry={title:title,keywords:lib.keywords,char:getEmoji(lib),category:translateCategory(categoryNameMap,lib.category)};var current=cats[entry.category]!==undefined?cats[entry.category]:[];cats[entry.category]=current.concat([entry]);everything.push(entry)});categories.set(Optional.some(cats));all.set(Optional.some(everything))};editor.on('init',function(){global$1.load(databaseId,databaseUrl).then(function(emojis){var userEmojis=getUserDefinedEmoticons(editor);processEmojis(merge(emojis,userEmojis))},function(err){console.log('Failed to load emoticons: '+err);categories.set(Optional.some({}));all.set(Optional.some([]))})});var listCategory=function(category){if(category===ALL_CATEGORY){return listAll()}
return categories.get().bind(function(cats){return Optional.from(cats[category])}).getOr([])};var listAll=function(){return all.get().getOr([])};var listCategories=function(){return[ALL_CATEGORY].concat(keys(categories.get().getOr({})))};var waitForLoad=function(){if(hasLoaded()){return global$3.resolve(!0)}else{return new global$3(function(resolve,reject){var numRetries=15;var interval=global$2.setInterval(function(){if(hasLoaded()){global$2.clearInterval(interval);resolve(!0)}else{numRetries--;if(numRetries<0){console.log('Could not load emojis from url: '+databaseUrl);global$2.clearInterval(interval);reject(!1)}}},100)})}};var hasLoaded=function(){return categories.get().isSome()&&all.get().isSome()};return{listCategories:listCategories,hasLoaded:hasLoaded,waitForLoad:waitForLoad,listAll:listAll,listCategory:listCategory}};var exists=function(xs,pred){for(var i=0,len=xs.length;i<len;i++){var x=xs[i];if(pred(x,i)){return!0}}
return!1};var map$1=function(xs,f){var len=xs.length;var r=new Array(len);for(var i=0;i<len;i++){var x=xs[i];r[i]=f(x,i)}
return r};var each$1=function(xs,f){for(var i=0,len=xs.length;i<len;i++){var x=xs[i];f(x,i)}};var setup=function(editor){editor.on('PreInit',function(){editor.parser.addAttributeFilter('data-emoticon',function(nodes){each$1(nodes,function(node){node.attr('data-mce-resize','false');node.attr('data-mce-placeholder','1')})})})};var emojiMatches=function(emoji,lowerCasePattern){return contains(emoji.title.toLowerCase(),lowerCasePattern)||exists(emoji.keywords,function(k){return contains(k.toLowerCase(),lowerCasePattern)})};var emojisFrom=function(list,pattern,maxResults){var matches=[];var lowerCasePattern=pattern.toLowerCase();var reachedLimit=maxResults.fold(function(){return never},function(max){return function(size){return size>=max}});for(var i=0;i<list.length;i++){if(pattern.length===0||emojiMatches(list[i],lowerCasePattern)){matches.push({value:list[i].char,text:list[i].title,icon:list[i].char});if(reachedLimit(matches.length)){break}}}
return matches};var init=function(editor,database){editor.ui.registry.addAutocompleter('emoticons',{ch:':',columns:'auto',minChars:2,fetch:function(pattern,maxResults){return database.waitForLoad().then(function(){var candidates=database.listAll();return emojisFrom(candidates,pattern,Optional.some(maxResults))})},onAction:function(autocompleteApi,rng,value){editor.selection.setRng(rng);editor.insertContent(value);autocompleteApi.hide()}})};var last=function(fn,rate){var timer=null;var cancel=function(){if(timer!==null){clearTimeout(timer);timer=null}};var throttle=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}
if(timer!==null){clearTimeout(timer)}
timer=setTimeout(function(){fn.apply(null,args);timer=null},rate)};return{cancel:cancel,throttle:throttle}};var insertEmoticon=function(editor,ch){editor.insertContent('&nbsp;'+ch+'&nbsp;')};var patternName='pattern';var open=function(editor,database){var initialState={pattern:'',results:emojisFrom(database.listAll(),'',Optional.some(300))};var currentTab=Cell(ALL_CATEGORY);var scan=function(dialogApi){var dialogData=dialogApi.getData();var category=currentTab.get();var candidates=database.listCategory(category);var results=emojisFrom(candidates,dialogData[patternName],category===ALL_CATEGORY?Optional.some(300):Optional.none());dialogApi.setData({results:results})};var updateFilter=last(function(dialogApi){scan(dialogApi)},200);var searchField={label:'Search',type:'input',name:patternName};var resultsField={type:'collection',name:'results'};var getInitialState=function(){var body={type:'tabpanel',tabs:map$1(database.listCategories(),function(cat){return{title:cat,name:cat,items:[searchField,resultsField]}})};return{title:'Emoticons',size:'normal',body:body,initialData:initialState,onTabChange:function(dialogApi,details){currentTab.set(details.newTabName);updateFilter.throttle(dialogApi)},onChange:updateFilter.throttle,onAction:function(dialogApi,actionData){if(actionData.name==='results'){insertEmoticon(editor,actionData.value);dialogApi.close()}},buttons:[{type:'cancel',text:'Close',primary:!0}]}};var dialogApi=editor.windowManager.open(getInitialState());dialogApi.focus(patternName);if(!database.hasLoaded()){dialogApi.block('Loading emoticons...');database.waitForLoad().then(function(){dialogApi.redial(getInitialState());updateFilter.throttle(dialogApi);dialogApi.focus(patternName);dialogApi.unblock()}).catch(function(_err){dialogApi.redial({title:'Emoticons',body:{type:'panel',items:[{type:'alertbanner',level:'error',icon:'warning',text:'<p>Could not load emoticons</p>'}]},buttons:[{type:'cancel',text:'Close',primary:!0}],initialData:{pattern:'',results:[]}});dialogApi.focus(patternName);dialogApi.unblock()})}};var register=function(editor,database){var onAction=function(){return open(editor,database)};editor.ui.registry.addButton('emoticons',{tooltip:'Emoticons',icon:'emoji',onAction:onAction});editor.ui.registry.addMenuItem('emoticons',{text:'Emoticons...',icon:'emoji',onAction:onAction})};function Plugin(){global.add('customEmoticons',function(editor,pluginUrl){var databaseUrl=getEmoticonDatabaseUrl(editor,pluginUrl);var databaseId=getEmoticonDatabaseId(editor);var database=initDatabase(editor,databaseUrl,databaseId);register(editor,database);init(editor,database);setup(editor)})}
Plugin()}(window.jQuery,window,document);if(window.jQuery===undefined)jQuery=$={};!function($,window,document){"use strict";$(function(){tinymce.PluginManager.add("quoteMessage",function(editor,url){editor.ui.registry.addButton('quoteMessage',{icon:'quoteMessage',tooltip:'Quote',onAction:function(_){editor.insertContent('\n[quote]'+editor.selection.getContent()+'[/quote]\n')}})})})}(window.jQuery,window,document)